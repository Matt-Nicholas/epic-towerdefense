<!DOCTYPE html>
<html lang="en">
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, maximum-scale=1.0, user-scalable=no" />
        <title>Tower Defense</title>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/phaser/2.0.6/phaser.min.js"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script type="text/javascript" src="js/Enemy.class.js"></script>
        <style>
            *{
                margin : 0;
            }
        </style>
    </head>
    <body>
      <h1>Schmower Defense</h1>
    </body>
    <script type="text/javascript">
        var game = new Phaser.Game(800, 632, Phaser.CANVAS, 'gameContainer', {preload: preload, create: create, update: update, render: render});
        var tileSquare = 32;
        var map, layer;
        var path = [{x: 0, y: 3},{x: 1, y: 3},{x: 2, y: 3},{x:3, y:3},{x:4, y:3},{x:5, y:3},{x:6, y:3},{x:7, y:3},{x:8, y:3},{x:9, y:3},{x:10, y:3},{x:10, y:4},{x:10, y:5},{x:10, y:6},{x:11, y:6},{x:12, y:6},{x:13, y:6},{x:14, y:6},{x:15, y:6},{x:15, y:5},{x:15, y:4},{x:15, y:3},{x:16, y:3},{x:17, y:3},{x:18, y:3},{x:19, y:3},{x:20, y:3},{x:21, y:3},{x:22, y:3},{x:23, y:3},{x:23, y:4},{x:23, y:5},{x:23, y:6},{x:23, y:7},{x:23, y:8},{x:23, y:9},{x:23, y:10},{x:23, y:11},{x:22, y:11},{x:21, y:11},{x:20, y:11},{x:19, y:11},{x:18, y:11},{x:17, y:11},{x:16, y:11},{x:15, y:11},{x:14, y:11},{x:14, y:12},{x:13, y:12},{x:12, y:12},{x:11, y:12},{x:10, y:12},{x:9, y:12},{x:8, y:12},{x:8, y:11},{x:8, y:10},{x:8, y:9},{x:8, y:8},{x:7, y:8},{x:6, y:8},{x:5, y:8},{x:4, y:8},{x:3, y:8},{x:3, y:9},{x:3, y:10},{x:3, y:11},{x:3, y:12},{x:3, y:13},{x:3, y:14},{x:3, y:15},{x:4, y:15},{x:5, y:15},{x:6, y:15},{x:7, y:15},{x:8, y:15},{x:9, y:15},{x:10, y:15},{x:11, y:15},{x:12, y:15},{x:12, y:16},{x:12, y:17},{x:12, y:18},{x:12, y:19},{x:12, y:20}];

        var enemysAnimation = [{'name': 'chain', 'length': 1}];

        function preload() {
            game.load.tilemap('level1', 'assets/maps/tower-defense.json', null, Phaser.Tilemap.TILED_JSON);
            game.load.image('tiles', 'assets/maps/map_tiles.png');

            /*
             * Enemy Preload
             */
             game.load.spritesheet('chain', 'assets/images/chain1.png', 32, 32, 1);

        }

        function create() {

            /**
             * Init map
             */
            game.physics.startSystem(Phaser.Physics.ARCADE)
            map = game.add.tilemap('level1');
            map.addTilesetImage('Level1', 'tiles');
            layer = map.createLayer('Ground');
            layer.resizeWorld();
            //game.input.onDown.add(listener, this);
            /*
             * Tower
             */


            /*
             * Towers Bullets
             */


            /*
             * Enemy
             */
             enemys = game.add.group();
             enemys.enableBody = true;
             enemys.physicsBodyType = Phaser.Physics.ARCADE;

             generateEnemy();
        }
        function render() {

        }
        function update() {
          /*
          * Generate Enemy
          */
          enemys.forEach(function(enemy) {
            Enemy.prototype.moveElmt(enemy);
          });

        }
        function listener() {

        }
        function collisionHandler() {

        }

        function generateEnemy() {
          var i = 0;
          var enemysBcl = setInterval(function() {
            if(i < 5) {
              var animEnemy = enemysAnimation[parseInt(Math.random() * enemysAnimation.length)];
              new Enemy(path[0].x * tileSquare, path[0].y * tileSquare, animEnemy.name, animEnemy.length);
            } else {
              clearTimeout(enemysBcl);
            }
            i++;
          }, 1000);
        }



    </script>
</html>
